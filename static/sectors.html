<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trending by Sectors</title>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <!-- Styles -->
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <div class="container">
    <div class="header glass-panel">
      <div class="nav">
        <div class="nav-left">
          <div class="logo">TrendTracker</div>
        </div>
        <div class="nav-links">
          <a href="/" class="nav-link">üî• Trending</a>
          <a href="/sectors" class="nav-link active">üè¢ Sectors</a>
          <a href="/chart" class="nav-link">üìà Charts</a>
        </div>
      </div>

      <div class="hero-content">
        <h1>Trending by Sectors</h1>
        <p class="subtitle">Business trending organized by industry sectors - updates every 5 minutes</p>
      </div>
    </div>

    <div id="loading" class="loading-container">
      <div class="spinner"></div>
      <div>Loading sector data...</div>
    </div>

    <div id="sectorsGrid" class="sectors-grid" style="display: none;"></div>
  </div>

  <script>
    // Sector mapping for companies
    const sectorMapping = {
      'Technology': ['Apple', 'Microsoft', 'Alphabet', 'Meta', 'NVIDIA', 'AMD', 'Advanced Micro Devices', 'Intel', 'Salesforce', 'Adobe', 'Palantir', 'Snowflake', 'CrowdStrike', 'Zoom', 'Slack', 'DocuSign', 'ASML Holding', 'Elastic', 'ServiceNow'],
      'E-commerce & Digital': ['Amazon', 'PayPal', 'Square', 'Uber', 'Airbnb', 'Spotify'],
      'Cryptocurrency': ['Coinbase', 'Robinhood'],
      'Media & Entertainment': ['Netflix', 'Disney', 'Warner Bros Discovery', 'Comcast'],
      'Automotive & EV': ['Tesla', 'Ford', 'General Motors', 'Rivian', 'Lucid Motors', 'ChargePoint'],
      'Financial Services': ['JPMorgan Chase', 'Bank of America', 'Wells Fargo', 'Goldman Sachs', 'Morgan Stanley', 'American Express', 'Visa', 'Mastercard', 'Berkshire Hathaway'],
      'Telecommunications': ['AT&T', 'Verizon', 'T-Mobile'],
      'Healthcare & Pharma': ['UnitedHealth', 'Anthem', 'Humana', 'CVS Health', 'Walgreens', 'Rite Aid', 'Pfizer', 'Johnson & Johnson', 'Moderna', 'Abbott', 'Medtronic', 'Boston Scientific', 'Intuitive Surgical'],
      'Life Sciences': ['Illumina', 'Thermo Fisher', 'Danaher', 'Agilent', 'Waters', 'PerkinElmer', 'Mettler Toledo'],
      'Energy & Oil': ['ExxonMobil', 'Chevron', 'ConocoPhillips', 'Marathon Petroleum', 'Valero'],
      'Utilities': ['NextEra Energy', 'Duke Energy', 'Dominion Energy', 'American Electric Power', 'Southern Company'],
      'Retail & Consumer': ['Walmart', 'Target', 'Costco', 'Home Depot', 'Nike', 'Adidas', 'Coca-Cola', 'PepsiCo', 'McDonald\'s', 'Starbucks'],
      'Industrial & Manufacturing': ['Caterpillar', 'Deere', '3M', 'General Electric', 'Honeywell'],
      'Aerospace & Defense': ['Lockheed Martin', 'Boeing', 'Raytheon', 'Northrop Grumman', 'General Dynamics', 'L3Harris', 'BAE Systems', 'Bombardier'],
      'Fitness & Lifestyle': ['Peloton', 'Beyond Meat'],
      'Gaming': ['Unity Software']
    };

    const sectorIcons = {
      'Technology': 'üíª',
      'E-commerce & Digital': 'üõí',
      'Cryptocurrency': '‚Çø',
      'Media & Entertainment': 'üé¨',
      'Automotive & EV': 'üöó',
      'Financial Services': 'üè¶',
      'Telecommunications': 'üì°',
      'Healthcare & Pharma': 'üè•',
      'Life Sciences': 'üß¨',
      'Energy & Oil': '‚õΩ',
      'Utilities': '‚ö°',
      'Retail & Consumer': 'üõçÔ∏è',
      'Industrial & Manufacturing': 'üè≠',
      'Aerospace & Defense': '‚úàÔ∏è',
      'Fitness & Lifestyle': 'üí™',
      'Gaming': 'üéÆ',
      'Other': 'üè¢'
    };

    let trendingData = [];

    async function fetchTrendingData() {
      try {
        const res = await fetch('/api/trending/all');
        trendingData = await res.json();
        renderSectors();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('sectorsGrid').style.display = 'grid';
      } catch (error) {
        document.getElementById('loading').textContent = 'Error loading data: ' + error.message;
      }
    }

    function renderSectors() {
      const grid = document.getElementById('sectorsGrid');
      grid.innerHTML = '';

      // Group companies by sector
      const sectorData = {};

      // Initialize sectors
      Object.keys(sectorMapping).forEach(sector => {
        sectorData[sector] = [];
      });

      // Categorize trending companies
      trendingData.forEach(company => {
        let assigned = false;
        for (const [sector, companies] of Object.entries(sectorMapping)) {
          if (companies.includes(company.name)) {
            sectorData[sector].push(company);
            assigned = true;
            break;
          }
        }
        // If not found in any sector, add to "Other"
        if (!assigned) {
          if (!sectorData['Other']) sectorData['Other'] = [];
          sectorData['Other'].push(company);
        }
      });

      // Sort sectors by total trending activity
      const sortedSectors = Object.entries(sectorData)
        .filter(([sector, companies]) => companies.length > 0)
        .sort((a, b) => {
          const aTotal = a[1].reduce((sum, c) => sum + c.lift, 0);
          const bTotal = b[1].reduce((sum, c) => sum + c.lift, 0);
          return bTotal - aTotal;
        });

      // Render each sector
      const neonColors = ['neon-cyan', 'neon-violet', 'neon-emerald', 'neon-amber', 'neon-rose'];

      sortedSectors.forEach(([sectorName, companies], idx) => {
        if (companies.length === 0) return;

        const colorTheme = neonColors[idx % neonColors.length];
        const sectorCard = document.createElement('div');
        sectorCard.className = 'sector-card glass-panel';
        // Add subtle border color based on theme
        sectorCard.style.borderColor = `var(--${colorTheme})`;
        sectorCard.style.boxShadow = `0 4px 20px -10px var(--${colorTheme}05)`; // Ultra subtle glow

        const icon = sectorIcons[sectorName] || 'üè¢';

        sectorCard.innerHTML = `
            <div class="sector-header">
              <div class="sector-title-group">
                <div class="sector-icon bg-${colorTheme}" style="border: 1px solid var(--${colorTheme}); background: rgba(0,0,0,0.2);">${icon}</div>
                <h3 class="sector-name text-${colorTheme}">${sectorName}</h3>
              </div>
              <div class="sector-count bg-${colorTheme}">${companies.length}</div>
            </div>
            <div class="company-list">
              ${companies.map(company => {
          const liftClass = company.lift > 2 ? 'lift high' : 'lift';
          return `
                  <div class="company-item">
                    <div class="company-cell">
                      <div class="company-name">${company.name}</div>
                      ${company.ticker ? `<div class="ticker">${company.ticker}</div>` : ''}
                    </div>
                    <div style="text-align: right;">
                      <div class="metric ${liftClass}">${company.lift.toFixed(1)}√ó</div>
                      <div class="stat-label" style="font-size: 9px;">Lift</div>
                    </div>
                  </div>
                `;
        }).join('')}
            </div>
          `;

        grid.appendChild(sectorCard);
      });

      if (sortedSectors.length === 0) {
        grid.innerHTML = '<div class="no-data">No trending companies found</div>';
      }
    }

    // Auto-refresh every 1 minute
    fetchTrendingData();
    setInterval(fetchTrendingData, 1000 * 60);
  </script>
</body>

</html>